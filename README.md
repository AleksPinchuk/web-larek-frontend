# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Ссылка на проект: [https://github.com/AleksPinchuk/web-larek-frontend](https://github.com/AleksPinchuk/web-larek-frontend)

Структура проекта:
- src/ — исходные файлы проекта
- src/pages/Catalog — папка с классом страницы и карточек
- src/widgets — папка с компонентами представления
- src/shared — папка с базовым кодом
- src/entities/Catalog — папка с компонентом модели данных и API 

Важные файлы:
- index.html — HTML-файл главной страницы
- src/index.ts — точка входа приложения
- src/types/index.ts — файл с типами
- src/shared/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/shared/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
### **Описание проекта**  

Этот проект представляет собой веб-приложение интернет-магазина,в котором пользователи могут просматривать каталог товаров, добавлять их в корзину, оформлять заказы и получать дополнительную информацию о продуктах.  

В основе архитектуры приложения лежит паттерн проектирования **MVP (Model-View-Presenter)**. Каждый слой включает в себя соответствующие классы, описанные ниже. Взаимодействие между слоями реализовано через событийную модель и вызовы методов. Однако, в отличие от классической реализации MVP, слой **Presenter** не вынесен в отдельный класс, а встроен в основной скрипт приложения (`index.ts`). Это позволяет эффективно управлять логикой взаимодействия между компонентами.


## **Базовые типы (`src/types/index.ts`)**

### **Тип `IProductItem`**  
Описывает структуру товара в каталоге.

**Поля:**  
- `id: string` — уникальный идентификатор товара  
- `title: string` — название товара  
- `description: string` — описание товара  
- `image: string` — ссылка на изображение товара  
- `category: string` — категория товара  
- `price: number` — стоимость товара  
- `inBasket: boolean` — флаг, указывающий, добавлен ли товар в корзину  
- `basketIndex: number` — индекс товара в корзине  

---

### **Тип `IOrderAddress`**  
Адрес доставки и способ оплаты.

**Поля:**  
- `payment: string` — способ оплаты  
- `address: string` — адрес доставки  

---

### **Тип `IOrderContacts`**  
Контактные данные пользователя.

**Поля:**  
- `email: string` — электронная почта пользователя  
- `phone: string` — номер телефона пользователя  

---

### **Тип `IOrderForm`**  
Объединение `IOrderAddress` и `IOrderContacts`, представляющее форму заказа.

---

### **Тип `IOrder`**  
Полный заказ, включая список товаров и итоговую сумму.

**Поля:**  
- `payment: string` — способ оплаты  
- `address: string` — адрес доставки  
- `email: string` — электронная почта пользователя  
- `phone: string` — номер телефона пользователя  
- `items: string[]` — массив ID товаров, включенных в заказ  
- `total: number` — итоговая сумма заказа  

---

### **Тип `IOrderResult`**  
Результат оформления заказа.

**Структура:**  
- `result: { id: string; total: number } | { error: string }` — успешный результат или ошибка, возвращаемая сервером  

---

### **Тип `FormErrors`**  
Ошибки валидации формы заказа.

**Формат:**  
- Ключи — поля объекта `IOrder`  
- Значения — текст ошибки для соответствующего поля  

---

### **Тип `IAppState`**  
Глобальное состояние приложения.

**Поля:**  
- `catalog: IProductItem[]` — список всех товаров в каталоге  
- `basket: IProductItem[]` — товары, добавленные в корзину  
- `order: IOrder | null` — текущий заказ  
- `formErrors: FormErrors` — ошибки валидации формы заказа  

## **Компоненты модели данных (`src/entities/Catalog`)**  

### **Класс `CatalogState`**

`CatalogState` — это модель, расширяющая базовый класс `Model`, предназначенный для реактивного хранения состояния. Отвечает за:

- Каталог товаров
- Корзину
- Предпросмотр товара
- Заказ и его валидацию
- Ошибки формы

---

### **Свойства**
- `catalog: IProductItem[]` — список всех товаров
- `basket: IProductItem[]` — список товаров, добавленных в корзину
- `order: IOrder` — объект текущего заказа
- `formErrors: FormErrors` — объект с ошибками полей формы
- `preview: string` — ID товара, выбранного для предпросмотра

---

### **Методы**

#### **setCatalog(items)**  
```ts
setCatalog(items: IProductItem[]): void
```
Сохраняет товары в каталог и уведомляет подписчиков (`items:changed`).

#### **addToBasket(item)**  
```ts
addToBasket(item: IProductItem): void
```
Добавляет товар в корзину и помечает его как добавленный (`inBasket: true`).

#### **removeFromBasket(item)**  
```ts
removeFromBasket(item: IProductItem): void
```
Удаляет товар из корзины и обновляет его состояние (`inBasket: false`).

#### **getTotalBasketPrice()**  
```ts
getTotalBasketPrice(): number
```
Возвращает общую стоимость всех товаров в корзине.

#### **getBasketItemsCount()**  
```ts
getBasketItemsCount(): number
```
Возвращает количество товаров в корзине.

#### **setPreview(item)**  
```ts
setPreview(item: IProductItem): void
```
Устанавливает ID товара для предпросмотра и отправляет событие `preview:changed`.

#### **setOrderField(field, value)**  
```ts
setOrderField(field: keyof IOrderForm, value: string): void
```
Обновляет конкретное поле формы заказа. При успешной валидации отправляет событие `order:ready`.

#### **validateOrder()**  
```ts
validateOrder(): boolean
```
Проверяет заполненность всех полей формы. Сохраняет и отправляет ошибки (`formErrors:change`).

#### **clearBasket()**  
```ts
clearBasket(): void
```
Очищает корзину и снимает флаг `inBasket` у всех товаров.

#### **resetOrder()**  
```ts
resetOrder(): void
```
Сбрасывает данные формы заказа до начальных значений.

---

### **Приватные методы**

- **findProductInCatalog(id)** — ищет товар в каталоге по ID  
- **updateBasket(newBasket, item, isAdding?)** — обновляет список корзины и статус `inBasket`  
- **validateOrderFields()** — проверяет поля формы заказа и формирует объект ошибок  


## **Взаимодействие с сервером (`src/shared/api`)**  

### **Класс `Methods`**  
`Methods` — это класс для работы с API, который наследуется от `Api` и отвечает за взаимодействие с сервером. Он позволяет загружать список товаров и отправлять заказы.  

---

### **Основные свойства**  

- `cdn: string` — базовый URL для загрузки изображений товаров  
- `baseUrl: string` — базовый URL API (унаследовано от `Api`)  
- `options?: RequestInit` — настройки запросов (унаследовано от `Api`)  

---

### **Методы**

#### **getAllProducts()**  
```ts
getAllProducts(): Promise<IProductItem[]>
```
Отправляет GET-запрос на `/product`, обрабатывает ответ, добавляет флаг `inBasket: false` и формирует полный путь к изображению. Возвращает обновлённый список товаров.

#### **createOrder(order: IOrder)**  
```ts
createOrder(order: IOrder): Promise<IOrder>
```
Отправляет POST-запрос на `/order` с данными заказа и возвращает подтверждённый заказ от сервера.

#### **processProductResponse(data)**  
```ts
processProductResponse(data: any): void
```
Принимает ответ от сервера, обрабатывает каждый товар с помощью метода `enhanceProductItem`.

#### **enhanceProductItem(item)**  
```ts
enhanceProductItem(item: IProductItem): void
```
Добавляет к товару флаг `inBasket: false` и формирует полный путь к изображению с помощью метода `constructImageUrl`.

#### **constructImageUrl(imagePath)**  
```ts
constructImageUrl(imagePath: string): string
```
Генерирует полный путь к изображению, используя `cdn` и относительный путь к файлу.

### **Компоненты представления (View)**

### Catalog

Компонент отображения каталога товаров. Обновляет количество товаров в корзине, список карточек и блокирует прокрутку страницы при открытии модальных окон.

- `set counter(value: number)` — отображает количество товаров в корзине.
- `set catalog(items: HTMLElement[])` — отрисовывает карточки товаров.
- `set locked(value: boolean)` — блокирует скролл страницы при открытом модальном окне.
- При клике по иконке корзины эмитит событие `basket:open`.

### ProductCard

Компонент карточки товара. Отображает заголовок, цену, изображение, категорию, описание и кнопку действия.

- `set title(value: string)` — заголовок карточки.
- `set price(value: number)` — отображает цену в синапсах или "Бесценно" и отключает кнопку при `null`.
- `set category(value: string)` — отображает категорию и добавляет модификатор класса.
- `set buttonText(value: string)` — текст на кнопке.
- `set image(value: string)` — изображение товара.
- `set description(value: string[] | string)` — описание в виде строки или массива абзацев.
- `set basketIndex(value: number)` — порядковый номер в корзине.

Поддерживает параметр `inBasket`, при котором кнопка становится неактивной. При клике по кнопке вызывает `actions.onClick`.

### Basket

Компонент корзины. Показывает список выбранных товаров и сумму заказа. Управляет состоянием кнопки "Оформить".

- `set items(items: HTMLElement[])` — обновляет список товаров. Если он пуст, отображает сообщение "Корзина пуста".
- `set total(total: number)` — отображает итоговую сумму заказа.
- При клике на кнопку оформления эмитит событие `order:open`.

### Success

Компонент успешного оформления заказа.

- `set total(value: number)` — отображает сообщение о списании синапсов.
- Обрабатывает клик по кнопке закрытия через `actions.onClick`.

### Form

Базовый класс формы. Управляет валидацией и отображением ошибок.

- `set valid(value: boolean)` — включает или отключает кнопку отправки.
- `set errors(value: string)` — выводит текст ошибки.
- `render(state: Partial<T> & IFormState)` — обновляет состояние формы и поля ввода.
- Эмитит события вида `formName.fieldName:change` при вводе данных и `formName:submit` при отправке.

### OrderFormAddress

Форма выбора адреса и способа оплаты.

- При клике по кнопке оплаты добавляет активный класс и эмитит событие `payment` через `emitFieldChange`.


#### **Компонент `Modal`**
Отображает модальное окно, которое можно открыть и закрыть, и позволяет заменить его содержимое.

- **Методы**:
  - `set content`: обновляет содержимое модального окна.
  - `open`: открывает модальное окно.
  - `close`: закрывает модальное окно.
  - `render`: рендерит модальное окно и открывает его.

